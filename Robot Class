import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.Image;
import javax.imageio.ImageIO;

public class Robot extends GameObject {
    public int velocityX = 0, velocityY = 0;
    public char direction = 'R';
    Image spriteUp, spriteDown, spriteLeft, spriteRight;
    Image currentSprite;
    private int tileSize;
    private boolean speedBoostActive;
    private int speedUpgradeLevel = 0;

    public Robot(int x, int y, int tileSize) {
        super(x, y, tileSize, tileSize);
        this.tileSize = tileSize;
        loadSprites();
        currentSprite = spriteRight;
    }
    

    public void setSpeedBoostActive(boolean active) {
        this.speedBoostActive = active;
    }

    void loadSprites() {
        try {
            spriteUp = ImageIO.read(getClass().getResource("/robot_up.png"));
            spriteDown = ImageIO.read(getClass().getResource("/robot_down.png"));
            spriteLeft = ImageIO.read(getClass().getResource("/robot_left.png"));
            spriteRight = ImageIO.read(getClass().getResource("/robot_right.png"));
        } catch (Exception e) {
            System.out.println("Error loading sprites: " + e.getMessage());
            System.out.println("Make sure robot_up.png, robot_down.png, robot_left.png, and robot_right.png are in the src folder");
        }
    }

    @Override
    void update() {
        // Robot doesn't need update logic here, but we must implement it
    }

    @Override
    void draw(Graphics2D g2) {
        if (currentSprite != null) {
            int robotSize = (int)(tileSize * 1.5);
            int offset = (tileSize - robotSize) / 2;
            g2.drawImage(currentSprite, x + offset, y + offset, robotSize, robotSize, null);
        } else {
            g2.setColor(new Color(100, 150, 255));
            g2.fillRoundRect(x + 2, y + 2, width - 4, height - 4, 8, 8);
            g2.setColor(Color.WHITE);
            g2.fillOval(x + 6, y + 6, 8, 8);
            g2.fillOval(x + 18, y + 6, 8, 8);
        }

        if (speedBoostActive) {
            g2.setColor(new Color(0, 255, 255, 100));
            g2.fillOval(x - 4, y - 4, width + 8, height + 8);
        }
    }

    public void updateDirection(char newDirection) {
        this.direction = newDirection;

        switch(newDirection) {
            case 'U': currentSprite = spriteUp; break;
            case 'D': currentSprite = spriteDown; break;
            case 'L': currentSprite = spriteLeft; break;
            case 'R': currentSprite = spriteRight; break;
        }

        updateVelocity();
    }

    public void setSpeedUpgradeLevel(int level) {
        this.speedUpgradeLevel = level;
    }
    
    void updateVelocity() {
        int speed = tileSize/4 + (speedUpgradeLevel * 1); // +1 speed per level
        if (speedBoostActive) {
            speed = (int)(speed * 1.5);
        }
        
        switch(direction) {
            case 'U': velocityX = 0; velocityY = -speed; break;
            case 'D': velocityX = 0; velocityY = speed; break;
            case 'L': velocityX = -speed; velocityY = 0; break;
            case 'R': velocityX = speed; velocityY = 0; break;
        }
    }
}
